- name: Comment out default access log conf
  ansible.builtin.lineinfile:
    path: /etc/nginx/nginx.conf
    regexp: '^(\s+access_log .*)'
    backrefs: true
    line: '#\1'
  become: true

- name: Copy access log conf
  ansible.builtin.copy:
    src: files/access_log.conf
    dest: /etc/nginx/conf.d/
    mode: "0644"
    owner: root
    group: root
  become: true

- name: Restart nginx
  ansible.builtin.service:
    name: nginx
    state: restarted
  become: true
