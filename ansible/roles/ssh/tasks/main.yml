- name: Create ssh directory
  file:
    path: /home/isucon/.ssh
    state: directory
    mode: "0700"
    owner: "{{ ssh_user }}"
    group: "{{ ssh_group }}"
  become: true
  become_user: isucon

- name: Generate ssh key
  openssh_keypair:
    path: /home/isucon/.ssh/id_rsa
    owner: "{{ ssh_user }}"
    group: "{{ ssh_group }}"
  become: true
  become_user: "{{ ssh_user }}"

- name: Copy authorized_keys
  copy:
    src: files/authorized_keys
    dest: /home/isucon/.ssh/authorized_keys
    mode: "0600"
    owner: "{{ ssh_user }}"
    group: "{{ ssh_group }}"
  become: true
  become_user: "{{ ssh_user }}"

- name: Copy ssh_config
  copy:
    src: files/config
    dest: /home/isucon/.ssh/config
    mode: "0600"
    owner: "{{ ssh_user }}"
    group: "{{ ssh_group }}"
  become: true
  become_user: "{{ ssh_user }}"
